{% extends "base.html" %}

{% block content %}
<div class="w-full max-w-md bg-white rounded-xl p-8 shadow mx-auto mt-10">
  <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Create an Account</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-4 space-y-2">
        {% for category, message in messages %}
          <div class="p-3 text-sm text-center rounded
                      {% if category == 'success' %} bg-green-100 text-green-700
                      {% else %} bg-red-100 text-red-700 {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" class="space-y-4" onsubmit="return validateForm()">
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
        <input name="username" type="text" placeholder="Choose a username" required
               class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <input name="password" type="password" placeholder="Create a password" required
               class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none">
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">I am a...</label>
        <select name="role" id="role-select" onchange="toggleFields()"
                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none bg-white">
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
        </select>
    </div>

    <div id="student-fields" class="space-y-4 p-4 bg-gray-50 rounded border border-gray-200">
        <p class="text-xs text-gray-500 font-bold uppercase tracking-wide">Student Details</p>
        <div>
            <label class="block text-xs font-medium text-gray-600">Roll Number</label>
            <input name="roll_no" type="text" placeholder="e.g. 21"
                   class="w-full p-2 border rounded text-sm">
        </div>
        <div class="grid grid-cols-2 gap-2">
            <div>
                <label class="block text-xs font-medium text-gray-600">Class</label>
                <input name="class_name" type="text" placeholder="e.g. TY-CS"
                       class="w-full p-2 border rounded text-sm">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-600">Division</label>
                <input name="division" type="text" placeholder="e.g. A"
                       class="w-full p-2 border rounded text-sm">
            </div>
        </div>
    </div>

    <div id="teacher-fields" class="hidden space-y-4 p-4 bg-blue-50 rounded border border-blue-100">
        <p class="text-xs text-blue-500 font-bold uppercase tracking-wide">Teacher Details</p>
        <p class="text-xs text-gray-600">You can add the classes you manage (e.g., TY-CS Div A) after logging in via your Dashboard.</p>

        <div class="grid grid-cols-2 gap-2">
            <div>
                <label class="block text-xs font-medium text-gray-600">First Class</label>
                <input name="class_name_t" type="text" placeholder="e.g. TY-CS"
                       class="w-full p-2 border rounded text-sm">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-600">Division</label>
                <input name="division_t" type="text" placeholder="e.g. A"
                       class="w-full p-2 border rounded text-sm">
            </div>
        </div>
    </div>

    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2.5 rounded hover:bg-blue-700 transition duration-200">
        Register Account
    </button>
  </form>

  <p class="mt-6 text-center text-sm text-gray-600">
    Already have an account? <a href="/login" class="text-blue-600 hover:underline font-semibold">Login here</a>
  </p>
</div>

<script>
    function toggleFields() {
        const role = document.getElementById('role-select').value;
        const studentFields = document.getElementById('student-fields');
        const teacherFields = document.getElementById('teacher-fields');

        // Note: For 'teacher', we re-use the names or handle them in backend.
        // The backend expects 'class_name' and 'division'.
        // To prevent conflicts, we simple show/hide visually.

        if (role === 'teacher') {
            studentFields.classList.add('hidden');
            teacherFields.classList.remove('hidden');

            // Swap name attributes so backend catches the right one
            document.querySelector('#student-fields input[name="class_name"]').removeAttribute('name');
            document.querySelector('#student-fields input[name="division"]').removeAttribute('name');

            document.querySelector('#teacher-fields input[name="class_name_t"]').setAttribute('name', 'class_name');
            document.querySelector('#teacher-fields input[name="division_t"]').setAttribute('name', 'division');

        } else {
            teacherFields.classList.add('hidden');
            studentFields.classList.remove('hidden');

            // Swap name attributes back
            document.querySelector('#teacher-fields input[name="class_name"]').setAttribute('name', 'class_name_t');
            document.querySelector('#teacher-fields input[name="division"]').setAttribute('name', 'division_t');

            document.querySelector('#student-fields input[name="class_name_without_name"]').setAttribute('name', 'class_name'); // select by hierarchy in case name is gone

            // Easier way: Reset by reloading page or just manual DOM manipulation above.
            // For simplicity in this script, we just ensure inputs have correct names:
             document.querySelector('#student-fields input[type="text"][placeholder="e.g. TY-CS"]').setAttribute('name', 'class_name');
             document.querySelector('#student-fields input[type="text"][placeholder="e.g. A"]').setAttribute('name', 'division');
        }
    }
</script>
{% endblock %}